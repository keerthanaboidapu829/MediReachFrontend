<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>NearbyCare ‚Äî Enhanced Prototype</title>
<style>
  :root {
    --accent:#0077ff;
    --danger:#e63946;
    --muted:#555;
    --bg:#eaf6ff;
  }
  body {
    font-family: "Poppins", sans-serif;
    margin:0;
    color:#111;
    background: linear-gradient(135deg, #eaf6ff 0%, #fefefe 50%, #d1ecff 100%);
    background-attachment: fixed;
  }
  header {
    background: linear-gradient(90deg,#0077ff,#00b4d8);
    color:#fff;
    padding:18px 22px;
    text-align:center;
    box-shadow:0 3px 10px rgba(0,0,0,0.2);
    position: relative;
  }
  header::after {
    content:"";
    background:url('https://images.unsplash.com/photo-1580281657521-66b8f18c77a5?auto=format&fit=crop&w=1600&q=60') center/cover no-repeat;
    position:absolute;
    top:0; left:0; right:0; bottom:0;
    opacity:0.15;
    z-index:0;
  }
  header h1, header .small { position:relative; z-index:1; }

  main {
    display:grid;
    grid-template-columns:1fr 380px;
    gap:14px;
    padding:14px;
    min-height:calc(100vh - 90px);
  }
  .panel {
    background:#fff;
    border-radius:10px;
    box-shadow:0 5px 18px rgba(0,0,0,0.07);
    padding:14px;
    overflow:auto;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .panel:hover { transform:translateY(-3px); box-shadow:0 8px 20px rgba(0,0,0,0.1); }

  #map {
    height:100%;
    min-height:460px;
    border-radius:10px;
    background:url('https://images.unsplash.com/photo-1526256262350-7da7584cf5eb?auto=format&fit=crop&w=1200&q=60') center/cover no-repeat;
  }

  button {
    margin:6px 4px;
    padding:9px 12px;
    border-radius:6px;
    border:1px solid #ddd;
    cursor:pointer;
    font-weight:600;
  }
  .btn-primary { background:var(--accent); color:#fff; border:none; }
  .btn-danger { background:var(--danger); color:#fff; border:none; }
  .btn-warning { background:#ffbf69; border:none; color:#111; }
  .btn-secondary { background:#6c757d; color:#fff; border:none; }

  .place-item {
    padding:10px;
    border-bottom:1px solid #eee;
    display:flex;
    align-items:center;
    gap:10px;
  }
  .place-item img { width:60px; height:60px; border-radius:8px; object-fit:cover; }

  label { display:block; font-weight:600; margin-top:8px; }
  input[type="text"], textarea {
    width:100%;
    padding:8px;
    border-radius:6px;
    border:1px solid #ccc;
    margin-top:5px;
    font-size:14px;
  }
  .small { font-size:13px; color:var(--muted); }
  footer {
    text-align:center;
    padding:12px;
    background:#f0faff;
    color:#333;
    font-size:14px;
  }

  /* Page navigation styles */
  .page { display: none; }
  .page.active { display: block; }
  .nav-buttons {
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
  }
  .page-indicator {
    text-align: center;
    margin: 10px 0;
    font-weight: bold;
    color: var(--accent);
  }

  /* Image preview styles */
  #image-preview {
    max-width: 100%;
    max-height: 200px;
    margin-top: 10px;
    border-radius: 8px;
    display: none;
  }

  @media(max-width:960px){
    main{grid-template-columns:1fr;min-height:auto}
    #map{min-height:320px;}
  }
</style>
</head>

<body>
<header>
  <h1>NearbyCare ‚Äî Health & Emergency Assistant üåç</h1>
  <div class="small">Find hospitals, pharmacies, and health help near you</div>
</header>

<main>
  <!-- Left: Map -->
  <div class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div>
        <button id="btn-locate" class="btn-primary">üìç My Location</button>
        <button id="btn-accident" class="btn-warning">‚ö†Ô∏è Simulate Accident</button>
      </div>
      <span id="status" class="small"></span>
    </div>
    <div id="map">Loading map...</div>
    <div style="margin-top:10px;">
      <select id="place-type" style="padding:8px;border-radius:6px;border:1px solid #ddd">
        <option value="hospital">Hospitals</option>
        <option value="clinic">Clinics</option>
        <option value="pharmacy" selected>Pharmacies</option>
      </select>
      <button id="btn-find" class="btn-primary">Find Nearby</button>
    </div>
    <div id="places-list" style="max-height:240px;overflow:auto;margin-top:8px;"></div>
  </div>

  <!-- Right: Multi-page Actions -->
  <div class="panel">
    <!-- Page 1: Image Upload -->
    <div id="page-1" class="page active">
      <h3>Step 1: Upload Injury Image</h3>
      <label>Upload injury image (body part only)</label>
      <input type="file" id="injury-image" accept="image/*"/>
      <img id="image-preview" src="" alt="Image preview"/>
      <div id="image-result" class="small" style="margin-top:8px"></div>
      
      <div class="nav-buttons">
        <div></div> <!-- Empty div for spacing -->
        <button id="btn-to-symptoms" class="btn-primary">Next: Check Symptoms ‚Üí</button>
      </div>
    </div>

    <!-- Page 2: Symptoms Check -->
    <div id="page-2" class="page">
      <div class="page-indicator">Step 2 of 3</div>
      <h3>Check Symptoms</h3>
      <label>Describe your symptoms</label>
      <textarea id="symptoms" rows="3" placeholder="e.g. fever, cough, chest pain"></textarea>
      <button id="btn-check-symptoms" class="btn-primary" style="margin-top:8px">Check Symptoms</button>
      <div id="symptom-result" style="margin-top:8px"></div>
      
      <div class="nav-buttons">
        <button id="btn-to-image" class="btn-secondary">‚Üê Back to Image</button>
        <button id="btn-to-medicine" class="btn-primary">Next: Medicine Availability ‚Üí</button>
      </div>
    </div>

    <!-- Page 3: Medicine Availability -->
    <div id="page-3" class="page">
      <div class="page-indicator">Step 3 of 3</div>
      <h3>Medicine Availability</h3>
      <label>Medicine availability</label>
      <input type="text" id="medicine-name" placeholder="Enter medicine name..."/>
      <button id="btn-check-medicine" class="btn-primary" style="margin-top:8px">Check Availability</button>
      <div id="medicine-result" style="margin-top:8px"></div>
      
      <div class="nav-buttons">
        <button id="btn-to-symptoms-back" class="btn-secondary">‚Üê Back to Symptoms</button>
        <button id="btn-restart" class="btn-primary">Start Over</button>
      </div>
    </div>

    <!-- Emergency button (always visible) -->
    <hr/>
    <button id="btn-emergency" class="btn-danger" style="width:100%;font-size:15px;">üö® Emergency Call</button>
  </div>
</main>

<footer>
  ¬© 2025 NearbyCare Prototype ‚Äî For Educational Demo Only
</footer>

<script>
// Expanded Mock Data
const MOCK_STORES = [
  {name:'City Hospital',type:'hospital',img:'https://images.unsplash.com/photo-1580281657521-66b8f18c77a5?auto=format&fit=crop&w=400&q=60'},
  {name:'Green Pharmacy',type:'pharmacy',img:'https://images.unsplash.com/photo-1586788224331-947f9cd8df1d?auto=format&fit=crop&w=400&q=60'},
  {name:'Downtown Clinic',type:'clinic',img:'https://images.unsplash.com/photo-1627308595229-7830a5c91f9f?auto=format&fit=crop&w=400&q=60'},
  {name:'Blue Cross Pharmacy',type:'pharmacy',img:'https://images.unsplash.com/photo-1576765608648-bf5d9c6400b2?auto=format&fit=crop&w=400&q=60'},
  {name:'Apollo Hospital',type:'hospital',img:'https://images.unsplash.com/photo-1504439904031-93ded9b3d5f6?auto=format&fit=crop&w=400&q=60'}
];

const MOCK_INVENTORY = {
  'Green Pharmacy':['paracetamol','ibuprofen','amoxicillin','cetirizine','dolo-650','azithromycin'],
  'Blue Cross Pharmacy':['metformin','atorvastatin','aspirin','omeprazole','vitamin c','zincovit'],
  'City Hospital':['iv-fluids','betadine','bandages','paracetamol','pain-relief spray'],
  'Downtown Clinic':['paracetamol','cough syrup','pain gel'],
  'Apollo Hospital':['amoxicillin','paracetamol','iv-drip','glucose','diclofenac']
};

const MOCK_SYMPTOMS = {
  'fever': { cause:'Viral or bacterial infection', precautions:'Drink fluids, rest, take paracetamol if high fever.', medicine:'paracetamol, dolo-650' },
  'cough': { cause:'Cold, throat infection or allergies', precautions:'Drink warm water, avoid cold drinks, take syrup if severe.', medicine:'cough syrup, cetirizine' },
  'chest pain': { cause:'Muscle strain or possible cardiac issue', precautions:'Avoid heavy activity, seek doctor if persists.', medicine:'pain relief gel' },
  'headache': { cause:'Stress, dehydration or migraine', precautions:'Rest, drink water, avoid screen time.', medicine:'paracetamol, ibuprofen' },
  'vomiting': { cause:'Food poisoning or viral infection', precautions:'Drink ORS, avoid oily food, rest.', medicine:'domperidone, ondansetron' },
  'shoulder pain': { cause:'Muscle strain, rotator cuff injury, or arthritis', precautions:'Rest shoulder, apply ice pack, avoid heavy lifting.', medicine:'ibuprofen, pain relief gel' }
};

// Page Navigation Functions
function showPage(pageNumber) {
  // Hide all pages
  document.querySelectorAll('.page').forEach(page => {
    page.classList.remove('active');
  });
  
  // Show the selected page
  document.getElementById(`page-${pageNumber}`).classList.add('active');
}

// Initialize with page 1
showPage(1);

// Render function
function renderPlaceList(list){
  const c=document.getElementById('places-list');
  c.innerHTML='';
  list.forEach(p=>{
    const el=document.createElement('div');
    el.className='place-item';
    el.innerHTML=`<img src="${p.img}" alt="img"/><div><strong>${p.name}</strong><br><span class="small">${p.type}</span></div>`;
    c.appendChild(el);
  });
}

// Event handlers for page navigation
document.getElementById('btn-to-symptoms').onclick = () => showPage(2);
document.getElementById('btn-to-image').onclick = () => showPage(1);
document.getElementById('btn-to-medicine').onclick = () => showPage(3);
document.getElementById('btn-to-symptoms-back').onclick = () => showPage(2);
document.getElementById('btn-restart').onclick = () => {
  // Reset form fields
  document.getElementById('injury-image').value = '';
  document.getElementById('image-preview').style.display = 'none';
  document.getElementById('image-result').innerHTML = '';
  document.getElementById('symptoms').value = '';
  document.getElementById('symptom-result').innerHTML = '';
  document.getElementById('medicine-name').value = '';
  document.getElementById('medicine-result').innerHTML = '';
  
  // Go back to first page
  showPage(1);
};

// Event handlers for functionality
document.getElementById('btn-find').onclick=()=>{
  renderPlaceList(MOCK_STORES);
  document.getElementById('status').textContent='Showing mock nearby places';
};

document.getElementById('btn-check-medicine').onclick=()=>{
  const name=document.getElementById('medicine-name').value.trim().toLowerCase();
  const res=document.getElementById('medicine-result');
  if(!name){ res.innerHTML='‚ö†Ô∏è Please enter a medicine name.'; return; }
  const found=Object.entries(MOCK_INVENTORY).filter(([store,meds])=>meds.some(m=>m.includes(name)));
  if(!found.length) res.innerHTML=`‚ùå No stores have "${name}".`;
  else res.innerHTML=found.map(([s,meds])=>`‚úÖ <strong>${s}</strong> has ${meds.join(', ')}`).join('<br>');
};

// Enhanced symptom checker that finds nearby stores with suggested medicines
document.getElementById('btn-check-symptoms').onclick=()=>{
  const txt=document.getElementById('symptoms').value.toLowerCase();
  const res=document.getElementById('symptom-result');
  if(!txt){ res.innerHTML='‚ö†Ô∏è Please describe your symptoms.'; return; }

  let matched=null;
  for(const key in MOCK_SYMPTOMS){
    if(txt.includes(key)){ matched=MOCK_SYMPTOMS[key]; break; }
  }

  if(matched){
    const meds = matched.medicine.split(',').map(m=>m.trim().toLowerCase());
    let availableStores = [];

    // Find stores that have at least one of the suggested medicines
    for(const [store, inventory] of Object.entries(MOCK_INVENTORY)){
      const found = meds.filter(m => inventory.includes(m));
      if(found.length > 0){
        availableStores.push({store, meds:found});
      }
    }

    let storeInfo = availableStores.length
      ? availableStores.map(s=>`‚úÖ <strong>${s.store}</strong> has: ${s.meds.join(', ')}`).join('<br>')
      : '‚ùå No nearby stores have the suggested medicines.';

    res.innerHTML = `
      <strong>Possible Cause:</strong> ${matched.cause}<br>
      <strong>Precautions:</strong> ${matched.precautions}<br>
      <strong>Suggested Medicines:</strong> ${matched.medicine}<br><br>
      <strong>Nearby Availability:</strong><br>${storeInfo}
    `;
  } else {
    res.innerHTML='‚ö†Ô∏è No match found. Please consult a doctor.';
  }
};

// File upload (mock image analysis) - NOW INCLUDES SHOULDER INJURY
document.getElementById('injury-image').onchange=(e)=>{
  const file=e.target.files[0];
  const res=document.getElementById('image-result');
  const preview=document.getElementById('image-preview');
  
  if(!file){ 
    res.innerHTML='No file selected.';
    preview.style.display='none';
    return; 
  }
  
  if(!file.type.startsWith('image/')){ 
    res.innerHTML='Please upload an image file.';
    preview.style.display='none';
    return; 
  }

  // Show image preview
  const reader = new FileReader();
  reader.onload = function(e) {
    preview.src = e.target.result;
    preview.style.display = 'block';
  }
  reader.readAsDataURL(file);

  const name=file.name.toLowerCase();
  const bodyParts=['hand','leg','arm','head','face','foot','back','chest','shoulder'];
  const matchedPart=bodyParts.find(p=>name.includes(p));

  if(!matchedPart){
    res.innerHTML='‚ùå Not a recognized body part image. Please upload a photo of a body part injury.';
    return;
  }

  switch(matchedPart){
    case 'hand': res.innerHTML='ü©π Possible hand bruise detected ‚Äî apply antiseptic & bandage.'; break;
    case 'leg': res.innerHTML='ü¶µ Possible leg injury ‚Äî clean wound & wrap lightly.'; break;
    case 'arm': res.innerHTML='üí™ Possible arm injury ‚Äî use ice pack and rest.'; break;
    case 'shoulder': 
      res.innerHTML='ü§∑ Shoulder injury detected ‚Äî apply ice pack, rest, and avoid heavy lifting. Consider shoulder sling for support.';
      break;
    case 'head': res.innerHTML='üß† Head area detected ‚Äî seek immediate medical help if swelling.'; break;
    case 'face': res.innerHTML='üò∑ Minor facial wound ‚Äî clean gently & apply antiseptic cream.';break;
    case 'foot': res.innerHTML='ü¶∂ Possible foot injury ‚Äî wash and apply ointment.'; break;
    case 'back': res.innerHTML='ü©ª Back strain ‚Äî apply ice pack & rest well.'; break;
    case 'chest': res.innerHTML='‚ù§Ô∏è Chest area detected ‚Äî seek medical help if pain persists.'; break;
    default: res.innerHTML='ü©∫ Image analyzed ‚Äî minor injury detected.';
  }
};

document.getElementById('btn-locate').onclick=()=>{ alert("Using mock location for now."); };
document.getElementById('btn-accident').onclick=()=>{ alert("Simulated accident nearby ‚Äî showing hospitals."); };
document.getElementById('btn-emergency').onclick=()=>{ alert("Call 108 or nearest emergency number immediately!"); };

renderPlaceList(MOCK_STORES);
</script>
</body>
</html>